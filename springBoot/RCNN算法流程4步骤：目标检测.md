RCNN算法流程4步骤：目标检测

1.候选区域选取 Selective Search

2.对每个候选区域，使用深度网络提取特征。输入图像大小227*227，图像分类网络就是CNN去除最后一个全连接层。所有

向量 候选区域*4096

3. 特征送入每一个类的SVM分类器，判定类别。非极大值抑制（IoU) 交/并
4. 使用回归器精细修正候选框位置。



fast RCNN算法流程4步骤：目标检测

1.候选区域选取 Selective Search

2.将图像输入网络得到相应的特性图，将ss算法生成的候选框投影到特征图上获得相应的特征矩阵。

（这些候选区域的特征不需要再重复计算）

3. 将每个特征矩阵通过ROI pooling 层缩放到7*7大小的特征图，然后展平通过一系列全连接层得到预测结果。(最大池化下采样，不限制输入图像的尺寸，通过两个全连接层得到ROI feature vector)

4.ROI feature vector 并联两个全连接层，一个用于目标概率预测（softmax，输出N+1个类别的概率，1为背景，N为检测目标的种类，和为1），另一个用于边界框回归参数预测（输出对应N+1个类别的候选边界框回归参数dx,dy,dw,dh 共N+1*4个节点）。



正样本有目标物体的样本，负样本没有目标物体的样本。batchsize 128,每张图像选取64个候选框，从每个候选框取25%作为正样本，只要该区域与目标区域IoU>0.5 负样本与真实目标边界框最大的在[0.1,0.5)

multi-task loss

[u>=1]艾弗森括号 u>=1 为1，否则为0



fast RCNN 速度瓶颈在SS算法上。



Faster RCNN步骤：

1.将图像输入网络得到相应的特征图

2.使用RPN 结构生成候选框，将RPN生成的候选框投影到特征图上获得相应的特征矩阵。

3.将每个特征矩阵通过ROI pooling 层缩放到7*7大小的特征图，接着将特征图展平通过一系列全连接层得到预测结果。RPN+Fast RCNN

region proposal network



对于特征图上的每个3*3的滑动窗口，计算出滑动窗口中心点对应原始图像上的中心点，并计算出k个anchor boxes(注意和proposal的差异)。

k个 anchor boxes 2k个score 为前景和背景的概率 4k coordinates

每个位置会有9个anchor

anchor经过RPN的回归参数调整后，才生成候选框。基于候选框的cls得分，采用非极大值抑制，IoU设为0.7，最后剩下的候选框正好与SS算法差不多。

在原图上的感受野：ZF 171   VGG 228